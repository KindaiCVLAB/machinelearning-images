# コントリビュートの手順

1. 変更する必要がある事項に対して template を用いて Issue を発行します．(Issue 上で他の開発者と変更に対して合意が取れているとスムーズに作業が進みます．)
2. 新しいブランチを作成して該当箇所を変更します．ブランチ名は変更に関連する用語が適切です．(ドキュメントを更新する際の例: update-documents)
3. リモートブランチに push します．
4. master ブランチへの Pull Request をテンプレートを用いて作成します．その際，1 で作成した Issue 番号を貼り付けます．
5. 作業中の場合は Draft マークをつけます．
6. 変更が完了して，全てのビルドおよびテストに合格したら `@ml-image-maintainers` にレビューリクエストを送ります．
7. 1名から Approval が付いたら Merge します．

# ライブラリバージョンのアップデート基準

本リポジトリが管理するコンテナイメージには以下のような 5 つのステータス及び 1 つの付帯事項を表すステータスが存在します．

|  STATUS  |Descriptioin|
|:--------:|:----------:|
|  closed  |セキュリティパッチや深刻なエラー修正も提供されないので，直ちに使用を停止してください．|
|deprecated|セキュリティパッチや深刻なエラー修正のみが提供されます．各ライブラリが最新版に更新されることはありません．|
|  stable  |安定版です．全てのライブラリが最新版に保たれています．|
|  latest  |最新安定版です．全てのライブラリが最新版に保たれており，サーバでの動作は確認していますが，一部動作しない環境があります．|
|  feature |新機能追加中のため特定の環境でしか動作しません．|
|   alpha  |一部 alpha バージョンのパッケージがインストールされていることを示します.|

付帯ステータスである alpha は nightly バージョンのライブラリを使用している場合やサーバで対応していないバージョンの cuda を使用している場合につける必要があります．


それぞれ 5 つのステータスごとにライブラリのアップデート基準が存在するので，以下に記述します．基準について変更する必要があると感じた場合は issue を発行してください．

- ベースイメージ cuda バージョンの選定基準と 1 週間毎の自動ビルドの有無

|  STATUS  |                                     cuda                                      |scheduled|
|:--------:|:-----------------------------------------------------------------------------:|:-------:|
|  closed  |                                       -                                       |   無し   |
|deprecated|                                       -                                       |   有り   |
|  stable  |           Pytorch or Tensorflow のアップストリームで公式サポートされている           |   有り   |
| feature  |Pytorch or Tensorflow のアップストリームで公式サポートされていないが，依存関係に問題がない |   有り   |


## closed

本ステータスのコンテナイメージは完全に開発を停止していることを表しています．
通常コンテナイメージはセキュリティパッチなどを当てるため 1 週間ごとに自動で再ビルドされていますが，closed ステータスのイメージは行われません．
そのため closed ステータスのコンテナイメージは何も更新してはいけません．

また，closed ステータスは，以下のいずれかの条件を満たした物とします．

- 最新の cudnn の一つ前のバージョンの[サポートリスト](https://docs.nvidia.com/deeplearning/cudnn/support-matrix/index.html)から外れた．
- [base イメージをビルドしているリポジトリ](https://gitlab.com/nvidia/container-images/cuda)から削除された．


## deprecated

本ステータスのコンテナイメージは使用が非推奨であることを示します．そのため，1 週間に 1度のセキュリティアップデートのみ実行し，その他のライブラリアップデートは実行しません．

ベースイメージに stable ステータスの cuda バージョンより 1 世代以上古い cuda を使用するコンテナイメージが deprecated ステータスとなります．

## stable

本ステータスのコンテナイメージは安定板であることを示します． そのため，1 週間に 1 度のセキュリティアップデートの実行およびすべてのライブラリを nightly バージョンを除く最新版に 1 ヶ月に 1回更新する必要があります.

## latest

本ステータスはコンテナイメージが最新安定板であることを示します．本ステータスは stable 版のライブラリに一部動作しない特異環境が存在する場合，それを nightly バージョンのライブラリを用いて改善した物になります．そのため，stable において特異環境が存在しない場合は latest バージョンを作成する必要がありません．

## feature

本ステータスはコンテナイメージが機能追加中であることを示します．

# 参考

- [cuda, cudnn, nvidia driver 対応表](https://docs.nvidia.com/deeplearning/cudnn/support-matrix/index.html)
- [base image の Dockerfile](https://gitlab.com/nvidia/container-images/cuda/-/blob/master/dist)
